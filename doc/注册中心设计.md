# 注册中心的设计

## 一.前提

[ 代理模型 ](代理模型.puml)

## 二.设计概要

[ 注册中心模型 ](注册中心模型.puml)

主要实现：

- provider能够在注册中心注册自己的服务

- consumer能够在注册中心发现需要的服务


## 三.详细设计
> 注册中心层

### 3.1 使用zookeeper作为注册中心

存储结构:

```json
{
  "zk-root": {
    "服务名": {
      "consumer": List<ServiceData>,
      "provider": List<ServiceData>
    }
  }
}
```
其中
ServiceData:
```json
{"appName": "服务别名", "ip": "地址", "port": "端口","token": "(隐式)传输的token"}
```


#### 3.1.1 注册层提供的接口(API以及SPI)
```
1.注册服务
接口名称:register
功能描述:注册接口
请求类型:硬编码
请求参数: ServiceData
响应参数: Boolean

2.下线服务
接口名称:unRegister
功能描述:下线接口
请求类型:硬编码
请求参数: ServiceData
响应参数: Boolean

3.订阅服务
接口名称:subscribe
功能描述:订阅服务
请求类型:硬编码
请求参数: ServiceData
响应参数: Boolean

4.关闭订阅
接口名称:Unsubscribe
功能描述:关闭订阅
请求类型:硬编码
请求参数: ServiceData
响应参数: Boolean

订阅应当会触发通知回调,目前可以处理为轮询-->这里将做一个防腐层
```

#### 3.1.2 变更通知

1. 发送变更事件

2. 变更事件处理器 Listener

#### 3.1.3 服务端的服务注册+客户端订阅服务

1. [工具类]读取配置
2. [工具类]服务端-根据配置注册服务端的服务
3. [工具类]客户端-根据配置订阅服务端的服务
4. 客户端-订阅成功的列表
5. 服务端-注册失败的处理
6. 调用超时的策略

#### 3.1.4 注册中心需要新启一个项目,作为服务治理层,这个先搁置.

1.泛化调用接口
2.服务治理-接口分析,调试能力
3.